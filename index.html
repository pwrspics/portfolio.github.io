<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PWRS.PICS PORTFOLIO</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">
<style>
  :root{ --glow: rgba(0,155,255,0.35); }
  html,body{height:100%;margin:0;font-family:"Montserrat",sans-serif;background:linear-gradient(135deg,#0a1f44,#113b6b,#1f6f8b,#99d8d0);background-size:400% 400%;animation:gradientShift 12s ease infinite;color:#fff;}
  @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
  header{padding:20px 12px 8px 12px;text-align:center;position:relative;}
  header h1{margin:0;font-size:30px;line-height:1;color:#d6f3ff;text-shadow:0 0 10px var(--glow);font-weight:700;}
  header .subtitle{display:block;font-size:28px;color:#d6f3ff;margin-top:6px;letter-spacing:1px}
  .control-btn{position:fixed;top:14px;left:14px;display:flex;align-items:center;justify-content:center;z-index:1200;background:rgba(255,255,255,0.12);border:2px solid rgba(255,255,255,0.35);border-radius:6px;padding:8px 12px;cursor:pointer;font-size:18px;color:#d6f3ff;transition:transform .18s ease, background .18s;}
  .control-btn:hover{transform:scale(1.06);background:rgba(255,255,255,0.18)}
  #xBtn{display:none} /* hidden on main page */
  .upload-btn{position:fixed;top:14px;right:14px;z-index:1200;display:none;background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.2);color:#d6f3ff;padding:8px 12px;border-radius:8px;cursor:pointer}
  .upload-btn:hover{background:rgba(255,255,255,0.2)}
  .page-container{width:95%;max-width:430px;margin:12px auto 88px;padding-top:0}
  .album-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-top:12px}
  .album{height:150px;border-radius:14px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.12);border:2px solid rgba(255,255,255,0.35);backdrop-filter:blur(6px);cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;padding:12px;font-weight:600;color:#d6f3ff;text-shadow:0 0 6px var(--glow)}
  .album:hover{transform:translateY(-4px) scale(1.03);background:rgba(255,255,255,0.18);box-shadow:0 8px 28px rgba(0,0,0,0.25)}
  .image-grid{display:grid;gap:12px;margin-top:18px;justify-items:stretch}
  .image-grid.cols-3{grid-template-columns:repeat(3,1fr);max-width:430px;margin:0 auto}
  .slot{width:100%;aspect-ratio:1/1;border-radius:8px;overflow:hidden;position:relative;background:linear-gradient(90deg,rgba(255,255,255,0.05)0%,rgba(255,255,255,0.15)50%,rgba(255,255,255,0.05)100%);border:2px solid rgba(255,255,255,0.25);display:flex;align-items:center;justify-content:center;color:#d6f3ff;font-weight:600;cursor:pointer;background-size:200% 100%;animation:shimmer 1.2s infinite;transition:transform .15s ease,box-shadow .15s ease,background .15s ease}
  .slot:hover{transform:scale(1.03);box-shadow:0 6px 18px rgba(0,0,0,0.25);background:rgba(255,255,255,0.12)}
  @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
  .slot.has-image{animation:none;background-size:cover;background-position:center;border:2px solid rgba(0,0,0,0.25)}
  .overlay{position:fixed;inset:0;display:none;z-index:2000;align-items:center;justify-content:center;background:rgba(0,0,0,0.72)}
  .overlay .box{background:rgba(255,255,255,0.12);border:2px solid rgba(255,255,255,0.35);color:#d6f3ff;padding:18px;border-radius:12px;max-width:92%;width:420px;text-align:center}
  .overlay img{max-width:100%;border-radius:8px;display:block;margin-bottom:12px}
  .close-btn{margin-top:12px;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-size:16px;background:rgba(255,255,255,0.18);color:#d6f3ff}
  .close-btn:hover{background:rgba(255,255,255,0.28);transform:scale(1.03)}
  #keypadOverlay{display:none;position:fixed;inset:0;z-index:2100;background:rgba(0,0,0,0.75);align-items:center;justify-content:center}
  .keypadCard{background:rgba(255,255,255,0.12);border:2px solid rgba(255,255,255,0.35);padding:16px;border-radius:10px;color:#d6f3ff;width:260px;text-align:center}
  .keypadDisplay{font-size:20px;letter-spacing:6px;margin-bottom:12px;min-height:26px}
  .keypadGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .key{padding:12px;font-size:18px;border-radius:8px;border:none;background:rgba(0,155,255,0.18);color:white;cursor:pointer}
  .key.clear{background:rgba(255,255,255,0.12)}
  #footer{position:fixed;left:0;right:0;bottom:0;height:48px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.18);color:#d6f3ff;font-size:14px;z-index:1000}
  @media(max-width:430px){header h1{font-size:24px}header .subtitle{font-size:20px}.album{height:130px}.control-btn{padding:7px 10px;font-size:16px}}
</style>
</head>
<body>
<header>
  <h1 id="titleTop">PWRS.PICS<br><span class="subtitle" id="titleBottom">PORTFOLIO</span></h1>
</header>

<button id="arrowBtn" class="control-btn" title="Main">←</button>
<button id="xBtn" class="control-btn" title="Back">✕</button>
<button id="uploadBtn" class="upload-btn">Upload</button>

<div class="page-container">
  <section id="main-page" class="page active">
    <div class="album-grid">
      <div class="album" onclick="openPageFromTile('sports-page','Sports')">Sports</div>
      <div class="album" onclick="openPageFromTile('outdoors-page','Outdoors')">Outdoors</div>
      <div class="album" onclick="openPageFromTile('private-page','Private Requests')" style="grid-column:span 2;">Private Requests</div>
    </div>
  </section>

  <section id="sports-page" class="page">
    <div class="album-grid">
      <div class="album" onclick="openAlbumFromTile('Football','Football')">Football</div>
      <div class="album" onclick="openAlbumFromTile('Basketball','Basketball')">Basketball</div>
      <div class="album" onclick="openAlbumFromTile('Baseball','Baseball')">Baseball</div>
      <div class="album" onclick="openAlbumFromTile('Track','Track/Cross Country')">Track/Cross Country</div>
      <div class="album" onclick="openAlbumFromTile('Lacrosse','Lacrosse')">Lacrosse</div>
      <div class="album" onclick="openAlbumFromTile('Frisbee','Ultimate Frisbee')">Ultimate Frisbee</div>
    </div>
  </section>

  <section id="outdoors-page" class="page">
    <div class="album-grid">
      <div class="album" onclick="openAlbumFromTile('Sunsets','Sunsets')">Sunsets</div>
      <div class="album" onclick="openAlbumFromTile('Animals','Animals')">Animals</div>
      <div class="album" onclick="openAlbumFromTile('Hydro Photography','Hydro Photography')">Hydro Photography</div>
      <div class="album" onclick="openAlbumFromTile('Night Shots','Night Shots')">Night Shots</div>
    </div>
  </section>

  <section id="private-page" class="page">
    <div class="album-grid">
      <div class="album" onclick="openAlbumFromTile('MustBook1','Must Book')">Must Book</div>
      <div class="album" onclick="openAlbumFromTile('MustBook2','Must Book')">Must Book</div>
      <div class="album" onclick="openAlbumFromTile('MustBook3','Must Book')">Must Book</div>
      <div class="album" onclick="openAlbumFromTile('MustBook4','Must Book')">Must Book</div>
    </div>
  </section>

  <section id="images-page" class="page">
    <div id="imageGridWrapper">
      <div id="image-grid" class="image-grid cols-3"></div>
    </div>
  </section>
</div>

<div id="overlay" class="overlay" aria-hidden="true">
  <div class="box" id="overlayBox"></div>
</div>

<div id="keypadOverlay" style="display:none;">
  <div class="keypadCard">
    <div class="keypadDisplay" id="keypadDisplay"></div>
    <div class="keypadGrid">
      <button class="key" onclick="pressKey('1')">1</button>
      <button class="key" onclick="pressKey('2')">2</button>
      <button class="key" onclick="pressKey('3')">3</button>
      <button class="key" onclick="pressKey('4')">4</button>
      <button class="key" onclick="pressKey('5')">5</button>
      <button class="key" onclick="pressKey('6')">6</button>
      <button class="key" onclick="pressKey('7')">7</button>
      <button class="key" onclick="pressKey('8')">8</button>
      <button class="key" onclick="pressKey('9')">9</button>
      <button class="key clear" onclick="pressKey('C')">C</button>
      <button class="key" onclick="pressKey('0')">0</button>
      <button class="key" onclick="pressKey('E')">OK</button>
    </div>
  </div>
</div>

<div id="footer">2025 @pwrs.pics</div>

<script src="https://apis.google.com/js/api.js"></script>
<script>
/* ========== Config & Drive IDs ========== */
const CLIENT_ID = '802750156240-0an68nrlfqcb970g0lv05chitdfasm5i.apps.googleusercontent.com';
const API_KEY   = 'AIzaSyBdRdRd7pXYgfeMqqWJ0mIHJlE-D6cuoScnc'.replace('RdRd','BdRd'); // original key intact
const SCOPES = 'https://www.googleapis.com/auth/drive.file';
const DRIVE_IDS = {
  "Outdoors":"1h7vd3dfW4c6IFDxkr_eYhoIcGn69KVpl","Sports":"1Wue8l85omJXn-_xO9PdYn0cariXbdMwx",
  "Private Requests":"1O3HmiO3-yqgW8K0plSRge8HBE45X9bvP","Animals":"1e4tnwMfsC39hQM296vZVdbZ556Q93o9t",
  "Hydro Photography":"1HukYKViFXLKloRDwgX3X3GLmIV0YyFzn","Sunsets":"14y0JpKpcIcHxeDR1eDfOFSv5m4HEuRcF",
  "Night Shots":"1mkKr0BoG-pvaz98HW2qjOY8I1_CIR57T","Football":"1CZnrl75VhSGneOPpWJ26fdESNBG4S4CB",
  "Baseball":"1nIZL73r9L6qytwoD11NfHzSR17azVSKh","Basketball":"1BnqyWGwyPppOYSK5Ns3SxgAXOnZb0KfI",
  "Lacrosse":"1x-XsL3CWUpBh33Uv7HYlDKiyZxfV2k3M","Track":"1_nangpmm5RwhusoNTGNJmOeYvhpqagxd",
  "Frisbee":"1AoCKIlQLiZD-YEhbU3NTOO-LBtcSwvxS","MustBook1":"190dh7F-7Vf5G2Q0-58ScfPD2zIiOS2AR",
  "MustBook2":"1PYY34VVmF9M43ueMCaWQAVD6P7G6F6qK","MustBook3":"1WHMzEHy82ueGdjLa7r26WwPunFPT0Cv6",
  "MustBook4":"1km8-78Gm_Vcv1rgG-wXIzhGOu3eoefG4"
};

/* ========== UI refs ========== */
const arrowBtn = document.getElementById('arrowBtn');
const xBtn = document.getElementById('xBtn');
const uploadBtn = document.getElementById('uploadBtn');
const titleTop = document.getElementById('titleTop');
const titleBottom = document.getElementById('titleBottom');
const imageGrid = document.getElementById('image-grid');
const overlay = document.getElementById('overlay');
const overlayBox = document.getElementById('overlayBox');
const keypadOverlay = document.getElementById('keypadOverlay');
const keypadDisplay = document.getElementById('keypadDisplay');

/* ========== State ========== */
let historyStack = [];                // stack of {pageId, visibleTitle}
let currentState = {pageId:'main-page', visibleTitle:'PORTFOLIO'};
let currentAlbum = null;
let keypadValue = '';
let gapiInitialized = false;

/* ========== GAPI init ========== */
function handleClientLoad(){ gapi.load('client:auth2', initClient); }
function initClient(){
  gapi.client.init({
    apiKey: API_KEY,
    clientId: CLIENT_ID,
    discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
    scope: SCOPES
  }).then(()=>{ gapiInitialized = true; });
}
handleClientLoad();

/* ========== Navigation functions (fixed) ========== */

function setTitle(titleText){
  titleTop.innerText = 'PWRS.PICS';
  titleBottom.innerText = (titleText||'PORTFOLIO').toUpperCase();
}

function openPage(pageId, visibleTitle){
  // push current state before changing (so X will go back to current)
  historyStack.push({...currentState});
  currentState = {pageId, visibleTitle: visibleTitle || 'PORTFOLIO'};

  // show/hide pages
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');

  // show/hide controls
  arrowBtn.style.display = (pageId === 'main-page') ? 'flex' : 'none';
  xBtn.style.display = (pageId === 'main-page') ? 'none' : 'flex';
  uploadBtn.style.display = (pageId === 'images-page') ? 'block' : 'none';

  // main page non-scroll
  if(pageId === 'main-page'){ document.documentElement.style.overflowY = 'hidden'; document.body.style.overflowY = 'hidden'; }
  else { document.documentElement.style.overflowY = 'auto'; document.body.style.overflowY = 'auto'; }

  setTitle( pageId === 'main-page' ? 'PORTFOLIO' : visibleTitle );
  // update current album only on images-page via openAlbum
}

function goBack(){
  // pop current state (we are "here") and restore previous
  if(historyStack.length === 0){
    // nothing to go back to -> show main
    currentState = {pageId:'main-page', visibleTitle:'PORTFOLIO'};
    openPage('main-page','PORTFOLIO'); // will push duplicate but that's okay if stack empty
    historyStack = [];
    return;
  }
  const prev = historyStack.pop(); // previous state
  // set currentState to prev but avoid pushing again
  currentState = prev;
  // show prev
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(prev.pageId).classList.add('active');
  arrowBtn.style.display = (prev.pageId === 'main-page') ? 'flex' : 'none';
  xBtn.style.display = (prev.pageId === 'main-page') ? 'none' : 'flex';
  uploadBtn.style.display = (prev.pageId === 'images-page') ? 'block' : 'none';
  if(prev.pageId === 'main-page'){ document.documentElement.style.overflowY = 'hidden'; document.body.style.overflowY = 'hidden'; }
  else { document.documentElement.style.overflowY = 'auto'; document.body.style.overflowY = 'auto'; }
  setTitle(prev.visibleTitle);
}

/* Wire arrow to go to main page (in-app) */
arrowBtn.addEventListener('click', ()=> {
  // clear history and go to main page
  historyStack.push({...currentState});
  currentState = {pageId:'main-page', visibleTitle:'PORTFOLIO'};
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('main-page').classList.add('active');
  arrowBtn.style.display = 'flex';
  xBtn.style.display = 'none';
  uploadBtn.style.display = 'none';
  document.documentElement.style.overflowY = 'hidden'; document.body.style.overflowY = 'hidden';
  setTitle('PORTFOLIO');
});

/* xBtn uses goBack already */
xBtn.addEventListener('click', goBack);

/* ========== Page opening wrappers for inline handlers ========== */
function openPageFromTile(pageId, visible){ openPage(pageId,visible); }
function openAlbumFromTile(albumKey, visibleName){
  // push current state then open images page
  historyStack.push({...currentState});
  currentAlbum = albumKey;
  currentState = {pageId:'images-page', visibleTitle: visibleName || albumKey};
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('images-page').classList.add('active');
  arrowBtn.style.display = 'none';
  xBtn.style.display = 'flex';
  uploadBtn.style.display = 'block';
  document.documentElement.style.overflowY = 'auto'; document.body.style.overflowY = 'auto';
  setTitle(visibleName || albumKey);
  // load images
  loadDriveImages(albumKey);
}

/* ========== Overlay (photo and unavailable) ========== */
function showOverlayImage(src){
  overlayBox.innerHTML = '';
  const img = document.createElement('img'); img.src = src; overlayBox.appendChild(img);
  const btn = document.createElement('button'); btn.className = 'close-btn'; btn.innerText = 'Close'; btn.onclick = hideOverlay;
  overlayBox.appendChild(btn);
  overlay.style.display = 'flex'; overlay.setAttribute('aria-hidden','false');
}
function showOverlayUnavailable(){
  overlayBox.innerHTML = '';
  const d = document.createElement('div'); d.innerText = 'Photo Unavailable'; d.style.fontSize='18px'; d.style.marginBottom='10px';
  overlayBox.appendChild(d);
  const btn = document.createElement('button'); btn.className='close-btn'; btn.innerText='Close'; btn.onclick = hideOverlay;
  overlayBox.appendChild(btn);
  overlay.style.display = 'flex'; overlay.setAttribute('aria-hidden','false');
}
function hideOverlay(){ overlay.style.display = 'none'; overlay.setAttribute('aria-hidden','true'); }

/* prevent background clicks from closing overlay */
overlay.addEventListener('click', (e)=>{ if(e.target === overlay) e.stopPropagation(); });

/* ========== Keypad (upload code gating) ========== */
function promptKeypad(){ keypadValue = ''; keypadDisplay.innerText = ''; keypadOverlay.style.display = 'flex'; }
function pressKey(k){
  if(k === 'C'){ keypadValue=''; keypadDisplay.innerText=''; return; }
  if(k === 'E'){
    if(keypadValue === '6826830'){ keypadOverlay.style.display = 'none'; startUploadFlow(); }
    else { alert('Incorrect code'); keypadValue=''; keypadDisplay.innerText=''; }
    return;
  }
  if(keypadValue.length < 10){ keypadValue += k; keypadDisplay.innerText = keypadValue.replace(/./g,'●'); }
}
document.getElementById('keypadOverlay').addEventListener('click', (e)=>{ if(e.target === document.getElementById('keypadOverlay')){ document.getElementById('keypadOverlay').style.display='none'; keypadValue=''; keypadDisplay.innerText=''; } });

/* ========== Google Drive integration (upload/list) ========== */

function ensureSignedIn(){
  if(!gapi.auth2) return Promise.reject('GAPI not ready');
  const auth = gapi.auth2.getAuthInstance();
  if(auth.isSignedIn.get()) return Promise.resolve(auth.currentUser.get().getAuthResponse(true).access_token);
  return auth.signIn().then(()=> auth.currentUser.get().getAuthResponse(true).access_token);
}

function startUploadFlow(){
  if(!currentAlbum){ alert('No album selected'); return; }
  ensureSignedIn().then((token)=>{
    const folderId = DRIVE_IDS[currentAlbum];
    if(!folderId){ alert('No folder configured for this album'); return; }
    const input = document.createElement('input'); input.type='file'; input.multiple=true; input.accept='image/*';
    input.onchange = (e)=>{
      const files = Array.from(e.target.files);
      const accessToken = gapi.auth.getToken().access_token;
      files.forEach(file=>{
        const metadata = {name:file.name, parents:[folderId]};
        const form = new FormData();
        form.append('metadata', new Blob([JSON.stringify(metadata)], {type:'application/json'}));
        form.append('file', file);
        fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id', {
          method:'POST', headers: {'Authorization':'Bearer '+accessToken}, body: form
        }).then(r=>r.json()).then(resp=>{
          // refresh images after upload
          setTimeout(()=> loadDriveImages(currentAlbum), 600);
        }).catch(err=>console.error('upload err',err));
      });
    };
    input.click();
  }).catch(err=>{ console.log('signin cancelled or error', err); });
}

/* loadDriveImages: shows shimmers, lists files in Drive folder, replaces slots.
   Shimmers removed after files are populated. */
function loadDriveImages(albumKey){
  const count = albumKey.startsWith('MustBook') ? 15 : 150;
  // show shimmers
  imageGrid.innerHTML = '';
  imageGrid.className = 'image-grid cols-3';
  for(let i=0;i<count;i++){ const s=document.createElement('div'); s.className='slot'; s.innerHTML = '<div class="empty-text">Loading</div>'; imageGrid.appendChild(s); }

  // list files
  ensureSignedIn().then(token=>{
    const folderId = DRIVE_IDS[albumKey];
    if(!folderId){ buildEmptySlots(count); return; }
    const q = `'${folderId}' in parents and mimeType contains 'image/' and trashed=false`;
    const url = 'https://www.googleapis.com/drive/v3/files?q=' + encodeURIComponent(q) + '&fields=files(id,name,mimeType,thumbnailLink,webContentLink)&pageSize=' + count;
    const accessToken = gapi.auth.getToken().access_token;
    fetch(url, { headers: { Authorization: 'Bearer ' + accessToken } })
      .then(r => r.json())
      .then(data => {
        const files = (data.files || []).slice(0, count);
        imageGrid.innerHTML = '';
        for(let i=0;i<count;i++){
          const slot = document.createElement('div'); slot.className='slot';
          if(files[i]){
            const imgUrl = `https://drive.google.com/uc?export=view&id=${files[i].id}`;
            slot.classList.add('has-image');
            slot.style.backgroundImage = `url(${imgUrl})`;
            slot.onclick = ()=> showOverlayImage(imgUrl);
          } else {
            slot.innerHTML = '<div class="empty-text">Empty</div>';
            slot.onclick = ()=> showOverlayUnavailable();
          }
          imageGrid.appendChild(slot);
        }
      }).catch(err=>{
        console.error('Drive list error', err);
        buildEmptySlots(count);
      });
  }).catch(()=> {
    // not signed in -> show empty slots
    buildEmptySlots(count);
  });
}

function buildEmptySlots(count){
  imageGrid.innerHTML = '';
  imageGrid.className = 'image-grid cols-3';
  for(let i=0;i<count;i++){
    const slot = document.createElement('div'); slot.className='slot';
    slot.innerHTML = '<div class="empty-text">Empty</div>';
    slot.onclick = ()=> showOverlayUnavailable();
    imageGrid.appendChild(slot);
  }
}

/* ========== Expose functions for inline handlers ========== */
window.openPageFromTile = openPageFromTile = openPage;
window.openAlbumFromTile = openAlbumFromTile;
window.pressKey = pressKey;
window.startUploadFlow = startUploadFlow;
window.loadDriveImages = loadDriveImages;

/* Initialize to main page */
openPage('main-page','PORTFOLIO');
</script>
</body>
</html>
